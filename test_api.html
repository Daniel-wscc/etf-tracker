<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡åƒ¹APIæ¸¬è©¦å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            margin-bottom: 10px;
            font-size: 2em;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-group label {
            font-weight: bold;
            min-width: 80px;
        }

        .control-group input, .control-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .results {
            padding: 20px;
        }

        .result-section {
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }

        .result-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-content {
            padding: 15px;
            background: white;
        }

        .json-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }

        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }

        .api-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }

        .price-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .price-item:last-child {
            border-bottom: none;
        }

        .price-label {
            font-weight: bold;
            color: #495057;
        }

        .price-value {
            color: #007bff;
            font-weight: bold;
        }

        .positive {
            color: #28a745;
        }

        .negative {
            color: #dc3545;
        }

        @media (max-width: 768px) {
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” è‚¡åƒ¹APIæ¸¬è©¦å·¥å…·</h1>
            <p>æ¸¬è©¦å°ç£è­‰äº¤æ‰€å’ŒYahoo Finance APIï¼ŒæŸ¥çœ‹å®Œæ•´çš„å›å‚³è³‡æ–™</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>è‚¡ç¥¨ä»£è™Ÿ:</label>
                <input type="text" id="stockSymbol" placeholder="ä¾‹å¦‚: 0050.TW, VTI, SPY" style="width: 200px;">
                <button class="btn btn-success" onclick="testAPIs()">ğŸ” æ¸¬è©¦API</button>
                <button class="btn" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
            </div>
            <div class="control-group">
                <label>å¸¸è¦‹è‚¡ç¥¨:</label>
                <select id="popularStocks" onchange="fillPopularStock()" style="width: 200px;">
                    <option value="">é¸æ“‡è‚¡ç¥¨</option>
                    <option value="0050.TW">0050 å…ƒå¤§å°ç£50</option>
                    <option value="0056.TW">0056 å…ƒå¤§é«˜è‚¡æ¯</option>
                    <option value="00878.TW">00878 åœ‹æ³°æ°¸çºŒé«˜è‚¡æ¯</option>
                    <option value="00679B.TW">00679B å…ƒå¤§ç¾å‚µ20å¹´</option>
                    <option value="00692.TW">00692 å¯Œé‚¦å…¬å¸æ²»ç†</option>
                    <option value="00881.TW">00881 åœ‹æ³°å°ç£5G+</option>
                    <option value="VTI">VTI ç¾åœ‹æ•´é«”è‚¡å¸‚</option>
                    <option value="SPY">SPY æ¨™æ™®500</option>
                    <option value="QQQ">QQQ é‚£æ–¯é”å…‹100</option>
                    <option value="AAPL">AAPL è˜‹æœ</option>
                    <option value="TSLA">TSLA ç‰¹æ–¯æ‹‰</option>
                </select>
            </div>
        </div>

        <div class="results" id="results">
            <div class="api-info">
                <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
            </div>
        </div>
    </div>

    <script>
        // å¡«å…¥å¸¸è¦‹è‚¡ç¥¨
        function fillPopularStock() {
            const select = document.getElementById('popularStocks');
            const symbol = select.value;
            if (symbol) {
                document.getElementById('stockSymbol').value = symbol;
                select.value = ''; // é‡ç½®é¸æ“‡
            }
        }

        // æ¸…é™¤çµæœ
        function clearResults() {
            document.getElementById('results').innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
            `;
        }

        // åˆ¤æ–·æ˜¯å¦ç‚ºå°ç£è‚¡ç¥¨
        function isTaiwanStock(symbol) {
            return symbol.toLowerCase().includes('.tw') || 
                   /^\d{4}$/.test(symbol) || 
                   /^\d{5}$/.test(symbol);
        }

        // æ¸¬è©¦æ‰€æœ‰API
        async function testAPIs() {
            const symbol = document.getElementById('stockSymbol').value.trim();
            if (!symbol) {
                alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ');
                return;
            }

            const resultsDiv = document.getElementById('results');
            
            // æ¸…é™¤ä¹‹å‰çš„çµæœï¼Œä¿ç•™èªªæ˜
            resultsDiv.innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="loading">æ­£åœ¨æ¸¬è©¦APIï¼Œè«‹ç¨å€™...</div>
            `;

            try {
                if (isTaiwanStock(symbol)) {
                    await testTaiwanAPI(symbol);
                } else {
                    await testInternationalAPI(symbol);
                }
            } catch (error) {
                showError('æ¸¬è©¦å¤±æ•—: ' + error.message);
            }
        }

        // æ¸¬è©¦å°ç£è‚¡ç¥¨API
        async function testTaiwanAPI(symbol) {
            const resultsDiv = document.getElementById('results');
            
            // è™•ç†è‚¡ç¥¨ä»£è™Ÿæ ¼å¼
            let stockCode = symbol.replace('.TW', '').replace('.tw', '');
            
            // åˆ¤æ–·äº¤æ˜“æ‰€
            let exchange = 'tse'; // é è¨­ç‚ºä¸Šå¸‚
            if (stockCode.startsWith('00') || parseInt(stockCode) >= 6000) {
                exchange = 'otc'; // ä¸Šæ«ƒ
            }
            
            const apiUrl = `https://mis.twse.com.tw/stock/api/getStockInfo.jsp?json=1&delay=0&ex_ch=${exchange}_${stockCode}.tw`;
            
            // é¡¯ç¤ºAPIè³‡è¨Š
            resultsDiv.innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="result-section">
                    <div class="result-header">
                        ğŸ‡¹ğŸ‡¼ å°ç£è­‰äº¤æ‰€APIæ¸¬è©¦ - ${symbol}
                        <span style="font-size: 12px; color: #666;">äº¤æ˜“æ‰€: ${exchange.toUpperCase()}</span>
                    </div>
                    <div class="result-content">
                        <div class="loading">æ­£åœ¨ç²å–è³‡æ–™...</div>
                    </div>
                </div>
            `;

            try {
                // ä½¿ç”¨ä»£ç†æœå‹™ä¾†é¿å…CORSå•é¡Œ
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`;
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const stockData = JSON.parse(data.contents);
                
                // é¡¯ç¤ºå®Œæ•´JSONè³‡æ–™
                displayTaiwanResults(symbol, stockData, apiUrl);
                
            } catch (error) {
                showTaiwanError(symbol, error, apiUrl);
            }
        }

        // é¡¯ç¤ºå°ç£è‚¡ç¥¨çµæœ
        function displayTaiwanResults(symbol, stockData, apiUrl) {
            const resultsDiv = document.getElementById('results');
            
            let resultHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="result-section">
                    <div class="result-header">
                        ğŸ‡¹ğŸ‡¼ å°ç£è­‰äº¤æ‰€APIæ¸¬è©¦ - ${symbol}
                        <span style="font-size: 12px; color: #666;">âœ… æˆåŠŸ</span>
                    </div>
                    <div class="result-content">
            `;

            if (stockData.msgArray && stockData.msgArray.length > 0) {
                const stock = stockData.msgArray[0];
                const price = parseFloat(stock.z) || parseFloat(stock.y);
                const change = stock.z ? parseFloat(stock.z) - parseFloat(stock.y) : 0;
                const changePercent = stock.z ? ((parseFloat(stock.z) - parseFloat(stock.y)) / parseFloat(stock.y) * 100) : 0;

                resultHTML += `
                    <div class="success">âœ… æˆåŠŸç²å–è‚¡åƒ¹è³‡æ–™</div>
                    <div class="price-display">
                        <h4>ğŸ“Š è‚¡åƒ¹è³‡è¨Š</h4>
                        <div class="price-item">
                            <span class="price-label">è‚¡ç¥¨ä»£è™Ÿ:</span>
                            <span class="price-value">${stock.c || symbol}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">è‚¡ç¥¨åç¨±:</span>
                            <span class="price-value">${stock.n || 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">ç›®å‰åƒ¹æ ¼:</span>
                            <span class="price-value">$${price ? price.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æ˜¨æ”¶åƒ¹æ ¼:</span>
                            <span class="price-value">$${stock.y ? parseFloat(stock.y).toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æ¼²è·Œé‡‘é¡:</span>
                            <span class="price-value ${change >= 0 ? 'positive' : 'negative'}">${change >= 0 ? '+' : ''}$${change.toFixed(2)}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æ¼²è·Œå¹…:</span>
                            <span class="price-value ${changePercent >= 0 ? 'positive' : 'negative'}">${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æˆäº¤é‡:</span>
                            <span class="price-value">${stock.v ? parseInt(stock.v).toLocaleString() : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æˆäº¤é‡‘é¡:</span>
                            <span class="price-value">${stock.a ? parseInt(stock.a).toLocaleString() : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">é–‹ç›¤åƒ¹:</span>
                            <span class="price-value">$${stock.o ? parseFloat(stock.o).toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æœ€é«˜åƒ¹:</span>
                            <span class="price-value">$${stock.h ? parseFloat(stock.h).toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æœ€ä½åƒ¹:</span>
                            <span class="price-value">$${stock.l ? parseFloat(stock.l).toFixed(2) : 'N/A'}</span>
                        </div>
                    </div>
                `;
            } else {
                resultHTML += `
                    <div class="error">âŒ æ‰¾ä¸åˆ°è‚¡ç¥¨è³‡æ–™ï¼Œè«‹æª¢æŸ¥è‚¡ç¥¨ä»£è™Ÿ</div>
                `;
            }

            resultHTML += `
                    <h4>ğŸ”— API URL</h4>
                    <div class="json-display">${apiUrl}</div>
                    
                    <h4>ğŸ“„ å®Œæ•´JSONå›æ‡‰</h4>
                    <div class="json-display">${JSON.stringify(stockData, null, 2)}</div>
                </div>
            </div>
            `;

            resultsDiv.innerHTML = resultHTML;
        }

        // é¡¯ç¤ºå°ç£è‚¡ç¥¨éŒ¯èª¤
        function showTaiwanError(symbol, error, apiUrl) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="result-section">
                    <div class="result-header">
                        ğŸ‡¹ğŸ‡¼ å°ç£è­‰äº¤æ‰€APIæ¸¬è©¦ - ${symbol}
                        <span style="font-size: 12px; color: #dc3545;">âŒ å¤±æ•—</span>
                    </div>
                    <div class="result-content">
                        <div class="error">âŒ éŒ¯èª¤: ${error.message}</div>
                        <h4>ğŸ”— API URL</h4>
                        <div class="json-display">${apiUrl}</div>
                        <h4>ğŸ’¡ å»ºè­°</h4>
                        <ul>
                            <li>æª¢æŸ¥è‚¡ç¥¨ä»£è™Ÿæ˜¯å¦æ­£ç¢º</li>
                            <li>ç¢ºèªè‚¡ç¥¨æ˜¯å¦åœ¨äº¤æ˜“æ™‚é–“</li>
                            <li>å˜—è©¦ä½¿ç”¨å®Œæ•´çš„ä»£è™Ÿæ ¼å¼ (å¦‚: 0050.TW)</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // æ¸¬è©¦åœ‹éš›è‚¡ç¥¨API
        async function testInternationalAPI(symbol) {
            const resultsDiv = document.getElementById('results');
            
            // é¡¯ç¤ºAPIè³‡è¨Š
            resultsDiv.innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="result-section">
                    <div class="result-header">
                        ğŸŒ Yahoo Finance APIæ¸¬è©¦ - ${symbol}
                        <span style="font-size: 12px; color: #666;">åœ‹éš›è‚¡ç¥¨</span>
                    </div>
                    <div class="result-content">
                        <div class="loading">æ­£åœ¨ç²å–è³‡æ–™...</div>
                    </div>
                </div>
            `;

            try {
                const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`;

                const response = await fetch(proxyUrl);
                const data = await response.json();
                const yahooData = JSON.parse(data.contents);

                // é¡¯ç¤ºå®Œæ•´JSONè³‡æ–™
                displayInternationalResults(symbol, yahooData, yahooUrl);
                
            } catch (error) {
                showInternationalError(symbol, error, yahooUrl);
            }
        }

        // é¡¯ç¤ºåœ‹éš›è‚¡ç¥¨çµæœ
        function displayInternationalResults(symbol, yahooData, yahooUrl) {
            const resultsDiv = document.getElementById('results');
            
            let resultHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="result-section">
                    <div class="result-header">
                        ğŸŒ Yahoo Finance APIæ¸¬è©¦ - ${symbol}
                        <span style="font-size: 12px; color: #666;">âœ… æˆåŠŸ</span>
                    </div>
                    <div class="result-content">
            `;

            if (yahooData.chart && yahooData.chart.result && yahooData.chart.result.length > 0) {
                const result = yahooData.chart.result[0];
                const meta = result.meta;
                const price = meta.regularMarketPrice || meta.previousClose;
                const change = meta.regularMarketPrice - meta.previousClose;
                const changePercent = (change / meta.previousClose) * 100;

                resultHTML += `
                    <div class="success">âœ… æˆåŠŸç²å–è‚¡åƒ¹è³‡æ–™</div>
                    <div class="price-display">
                        <h4>ğŸ“Š è‚¡åƒ¹è³‡è¨Š</h4>
                        <div class="price-item">
                            <span class="price-label">è‚¡ç¥¨ä»£è™Ÿ:</span>
                            <span class="price-value">${meta.symbol || symbol}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">è‚¡ç¥¨åç¨±:</span>
                            <span class="price-value">${meta.longName || meta.shortName || 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">ç›®å‰åƒ¹æ ¼:</span>
                            <span class="price-value">$${price ? price.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æ˜¨æ”¶åƒ¹æ ¼:</span>
                            <span class="price-value">$${meta.previousClose ? meta.previousClose.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æ¼²è·Œé‡‘é¡:</span>
                            <span class="price-value ${change >= 0 ? 'positive' : 'negative'}">${change >= 0 ? '+' : ''}$${change.toFixed(2)}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æ¼²è·Œå¹…:</span>
                            <span class="price-value ${changePercent >= 0 ? 'positive' : 'negative'}">${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æˆäº¤é‡:</span>
                            <span class="price-value">${meta.regularMarketVolume ? parseInt(meta.regularMarketVolume).toLocaleString() : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">é–‹ç›¤åƒ¹:</span>
                            <span class="price-value">$${meta.regularMarketOpen ? meta.regularMarketOpen.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æœ€é«˜åƒ¹:</span>
                            <span class="price-value">$${meta.regularMarketDayHigh ? meta.regularMarketDayHigh.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">æœ€ä½åƒ¹:</span>
                            <span class="price-value">$${meta.regularMarketDayLow ? meta.regularMarketDayLow.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">52é€±æœ€é«˜:</span>
                            <span class="price-value">$${meta.fiftyTwoWeekHigh ? meta.fiftyTwoWeekHigh.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">52é€±æœ€ä½:</span>
                            <span class="price-value">$${meta.fiftyTwoWeekLow ? meta.fiftyTwoWeekLow.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">å¸‚å€¼:</span>
                            <span class="price-value">${meta.marketCap ? formatMarketCap(meta.marketCap) : 'N/A'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">è²¨å¹£:</span>
                            <span class="price-value">${meta.currency || 'USD'}</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">äº¤æ˜“æ‰€:</span>
                            <span class="price-value">${meta.exchangeName || 'N/A'}</span>
                        </div>
                    </div>
                `;
            } else {
                resultHTML += `
                    <div class="error">âŒ æ‰¾ä¸åˆ°è‚¡ç¥¨è³‡æ–™ï¼Œè«‹æª¢æŸ¥è‚¡ç¥¨ä»£è™Ÿ</div>
                `;
            }

            resultHTML += `
                    <h4>ğŸ”— API URL</h4>
                    <div class="json-display">${yahooUrl}</div>
                    
                    <h4>ğŸ“„ å®Œæ•´JSONå›æ‡‰</h4>
                    <div class="json-display">${JSON.stringify(yahooData, null, 2)}</div>
                </div>
            </div>
            `;

            resultsDiv.innerHTML = resultHTML;
        }

        // é¡¯ç¤ºåœ‹éš›è‚¡ç¥¨éŒ¯èª¤
        function showInternationalError(symbol, error, yahooUrl) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="result-section">
                    <div class="result-header">
                        ğŸŒ Yahoo Finance APIæ¸¬è©¦ - ${symbol}
                        <span style="font-size: 12px; color: #dc3545;">âŒ å¤±æ•—</span>
                    </div>
                    <div class="result-content">
                        <div class="error">âŒ éŒ¯èª¤: ${error.message}</div>
                        <h4>ğŸ”— API URL</h4>
                        <div class="json-display">${yahooUrl}</div>
                        <h4>ğŸ’¡ å»ºè­°</h4>
                        <ul>
                            <li>æª¢æŸ¥è‚¡ç¥¨ä»£è™Ÿæ˜¯å¦æ­£ç¢º</li>
                            <li>ç¢ºèªè‚¡ç¥¨æ˜¯å¦åœ¨Yahoo Financeä¸Šæœ‰è³‡æ–™</li>
                            <li>å˜—è©¦ä½¿ç”¨ä¸åŒçš„ä»£è™Ÿæ ¼å¼</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // æ ¼å¼åŒ–å¸‚å€¼
        function formatMarketCap(marketCap) {
            if (marketCap >= 1e12) {
                return `$${(marketCap / 1e12).toFixed(2)}T`;
            } else if (marketCap >= 1e9) {
                return `$${(marketCap / 1e9).toFixed(2)}B`;
            } else if (marketCap >= 1e6) {
                return `$${(marketCap / 1e6).toFixed(2)}M`;
            } else {
                return `$${marketCap.toLocaleString()}`;
            }
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="api-info">
                    <strong>ğŸ“‹ APIèªªæ˜ï¼š</strong><br>
                    â€¢ <strong>å°ç£è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨å°ç£è­‰äº¤æ‰€å®˜æ–¹API (mis.twse.com.tw)<br>
                    â€¢ <strong>åœ‹éš›è‚¡ç¥¨APIï¼š</strong>ä½¿ç”¨Yahoo Finance API (query1.finance.yahoo.com)<br>
                    â€¢ <strong>ä»£ç†æœå‹™ï¼š</strong>ä½¿ç”¨allorigins.winè§£æ±ºCORSå•é¡Œ<br>
                    â€¢ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å°ç£è‚¡ç¥¨(.TW)ã€ç¾è‚¡ä»£è™Ÿã€ETFä»£è™Ÿç­‰
                </div>
                <div class="error">âŒ ${message}</div>
            `;
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                testAPIs();
            }
        });
    </script>
</body>
</html>
